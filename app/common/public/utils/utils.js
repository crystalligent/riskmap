'use strict';

angular.module('RISK').factory('utilities', ['$window','$rootScope',function ($window, $rootScope) {
    var utilities = {};
    var months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

    var dayColors = [
	"#81AEF1",	// noon
	"#164F9C",	// day
	"#02356A",	// twilight
	"black"		// night
    ];

    var hourState = {
                    sunrise:5,
                    sunset:20
    };


    utilities.hourcolor = function(h){
        var _getColorIndex = function(hour){
            if (hour == hourState.sunrise) return 2;
            if (hour == hourState.sunrise) return 2;
            if (hour > hourState.sunrise && hour < hourState.sunset) return 1;
            return 3;
        }

        return dayColors[_getColorIndex(h)];
    }
    

    utilities.formatDate= function(d){
        var date = new Date(d);
        return (date.getMonth() + 1) + '/' + date.getDate() + '/' +  date.getFullYear();
      };

    utilities.formatDate2= function(d){
        var date = new Date(d);
        return (date.getMonth() + 1) + '/' + date.getDate();
      };

      utilities.formatBoolToString = function(b){
          return b?'Yes':'No';
      }

      utilities.uuid = function(){
           var G = function () {
              return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1)
          }
          return (G() + G()  + G()  + G()  + G()  + G() + G() + G()).toLocaleLowerCase();
      }

      utilities.getPercent = function(a,total){
          if(total ==0 && a ==0) return "0%";                    
          return  ((a / total) * 100).toFixed(2)  + "%"
      }


      utilities.convert = {};
      
      utilities.convert.CtoF=  function(d){ return Math.round(((d * 9) / 5 + 32) * 10) / 10};
      utilities.convert.FtoC =  function(d){ return Math.round(((d -32) * 5 / 9) * 10) / 10};
      
      utilities.convert.MilestoKm =  function(d){ return Math.round((d * 1.60934) *10) / 10};
      utilities.convert.KmtoMiles =  function(d){ return Math.round((d * 0.621371) * 10) / 10};
      
      utilities.convert.CmtoInch = function(d){return Math.round((d / 2.54) *10) /10};
      utilities.convert.InchtoCm = function(d){return Math.round((d * 2.54) *10) /10};


      utilities.ObjSize = function(obj){
        var size = 0, key;
            for (key in obj) {
                if (obj.hasOwnProperty(key)) size++;
            }
            return size;          
      }

            
      utilities.sortDate =  (function (a, b) {
    	    var key1 = new Date(a.date.replace(/-/g, "/").replace(".0",""));
    	    var key2 = new Date(b.date.replace(/-/g, "/").replace(".0",""));

    	    if (key1 < key2) {
    	        return -1;
    	    } else if (key1 == key2) {
    	        return 0;
    	    } else {
    	        return 1;
    	    }
    	});

    utilities.formatToDecimal =  function(s){
 		if(!s) return 0;
 		return s.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
 	}

     utilities.formatDateAMPM =  function(dt){
		  var h =  dt.getHours();
		  var _time = (h >= 12) ? (((h==12)?12:h-12) +"PM") : (((h==0)?12:h) + "AM");		  
		  return _time;
	  }
      utilities.addhours =  function(date,h) {    
		  date.setTime(date.getTime() + (h*60*60*1000)); 
		  	return date ;   
		}
	  
      utilities.rand = function(min,max){
		  return Math.floor(Math.random() * (max - min + 1)) + min;
	  }
      
      
      utilities.getMonthDate =  function(date){
    	  return months[date.getMonth()] + " " + date.getDate();
      }

      utilities.forecast = {};
      utilities.forecast.chart = {};
      utilities.forecast.chart.forecastchartdata =  function(hours){
            var _temp = hours.map(function(d){return d.temp});
            var _rh = hours.map(function(d){return d.rh});

            var _x = []
                _x.push(_temp);
                _x.push(_rh);
            return _x;
        }

        utilities.forecast.chart.forecastchartlabels =  function(hours){
            var _labels = [];
            hours.map(function(d){return d.fcst_valid_local}).forEach(function(d){
                var _ampm = utilities.formatDateAMPM(new Date(d));
                _labels.push(_ampm);
            });

            return _labels;
        }


      utilities.geo = {}
      utilities.geo.tocoord = function(latng,angle,radius){
          var coord = {};
          var _angle = angle * Math.PI /180;           
           coord.lat = latng.lat + radius * Math.cos((2 * Math.PI * _angle));
           coord.lng = latng.lng + radius * Math.sin((2 * Math.PI * _angle));
    
          return coord;
      }

    utilities.geo.destinationPoint = function(latng,brng, dist) {
         dist = dist / 6371;  
         brng = brng.toRad();  

         var lat1 = latng.lat.toRad(), lon1 = latng.lng.toRad();

         var lat2 = Math.asin(Math.sin(lat1) * Math.cos(dist) + 
                              Math.cos(lat1) * Math.sin(dist) * Math.cos(brng));

         var lon2 = lon1 + Math.atan2(Math.sin(brng) * Math.sin(dist) *
                                      Math.cos(lat1), 
                                      Math.cos(dist) - Math.sin(lat1) *
                                      Math.sin(lat2));

         if (isNaN(lat2) || isNaN(lon2)) return null;

         return {lat:lat2.toDeg(), lng:lon2.toDeg()};
      }

      utilities.geo.testgeo = JSON.parse('{ "type" : "Polygon", "coordinates" : [ [ [ 120.993797, 14.712861 ], [ 120.992958, 14.712161 ], [ 120.992859, 14.712111 ], [ 120.992592, 14.71198 ], [ 120.992233, 14.711861 ], [ 120.991913, 14.711751 ], [ 120.991791, 14.7117 ], [ 120.991386, 14.71154 ], [ 120.991287, 14.7115 ], [ 120.990952, 14.711411 ], [ 120.990662, 14.711341 ], [ 120.990501, 14.71131 ], [ 120.989929, 14.71121 ], [ 120.989342, 14.711141 ], [ 120.989082, 14.711121 ], [ 120.988487, 14.711071 ], [ 120.988373, 14.71104 ], [ 120.988243, 14.711 ], [ 120.987427, 14.710741 ], [ 120.987213, 14.710661 ], [ 120.986862, 14.71053 ], [ 120.986351, 14.710331 ], [ 120.986198, 14.710291 ], [ 120.985916, 14.710212 ], [ 120.98571, 14.71016 ], [ 120.985176, 14.710031 ], [ 120.985367, 14.709631 ], [ 120.985497, 14.709431 ], [ 120.985611, 14.709361 ], [ 120.985992, 14.709301 ], [ 120.986168, 14.70925 ], [ 120.986328, 14.708941 ], [ 120.98645, 14.70888 ], [ 120.986679, 14.70888 ], [ 120.986816, 14.708851 ], [ 120.98716, 14.708401 ], [ 120.987312, 14.708211 ], [ 120.987473, 14.708 ], [ 120.987587, 14.707951 ], [ 120.987877, 14.707921 ], [ 120.988007, 14.707861 ], [ 120.988098, 14.70779 ], [ 120.988167, 14.707621 ], [ 120.9879, 14.7075 ], [ 120.987701, 14.70744 ], [ 120.98777, 14.70707 ], [ 120.986656, 14.706811 ], [ 120.986687, 14.7066 ], [ 120.986572, 14.706531 ], [ 120.986542, 14.70631 ], [ 120.986046, 14.70623 ], [ 120.985802, 14.706201 ], [ 120.985268, 14.706141 ], [ 120.984833, 14.706091 ], [ 120.98468, 14.706071 ], [ 120.98436, 14.706031 ], [ 120.983452, 14.705931 ], [ 120.983177, 14.705911 ], [ 120.98307, 14.70538 ], [ 120.982948, 14.705371 ], [ 120.982933, 14.705121 ], [ 120.986267, 14.7052 ], [ 120.986168, 14.70499 ], [ 120.985359, 14.70501 ], [ 120.985237, 14.70489 ], [ 120.984978, 14.70419 ], [ 120.985718, 14.704281 ], [ 120.985481, 14.70359 ], [ 120.985611, 14.703601 ], [ 120.985771, 14.703641 ], [ 120.987198, 14.703971 ], [ 120.987267, 14.70343 ], [ 120.986702, 14.703291 ], [ 120.98645, 14.70322 ], [ 120.986259, 14.70319 ], [ 120.985916, 14.70314 ], [ 120.984917, 14.703001 ], [ 120.984077, 14.702881 ], [ 120.98362, 14.70279 ], [ 120.983513, 14.70277 ], [ 120.983337, 14.702651 ], [ 120.982971, 14.702901 ], [ 120.982651, 14.70295 ], [ 120.982529, 14.702941 ], [ 120.98243, 14.702862 ], [ 120.982323, 14.70281 ], [ 120.982216, 14.702781 ], [ 120.982063, 14.702761 ], [ 120.981903, 14.70277 ], [ 120.981773, 14.70277 ], [ 120.981636, 14.702781 ], [ 120.981537, 14.702671 ], [ 120.981453, 14.702571 ], [ 120.98127, 14.70256 ], [ 120.98101, 14.702531 ], [ 120.980888, 14.702611 ], [ 120.980766, 14.702661 ], [ 120.980667, 14.702681 ], [ 120.980553, 14.702681 ], [ 120.980392, 14.702721 ], [ 120.980232, 14.70273 ], [ 120.980103, 14.702681 ], [ 120.979988, 14.702621 ], [ 120.979897, 14.702571 ], [ 120.979691, 14.702551 ], [ 120.97953, 14.702621 ], [ 120.979408, 14.702671 ], [ 120.979317, 14.702621 ], [ 120.979202, 14.70256 ], [ 120.978951, 14.70258 ], [ 120.978867, 14.702641 ], [ 120.978958, 14.702733 ], [ 120.979057, 14.70283 ], [ 120.978996, 14.70295 ], [ 120.978889, 14.702991 ], [ 120.978668, 14.703091 ], [ 120.978737, 14.7032 ], [ 120.978951, 14.70328 ], [ 120.979027, 14.703401 ], [ 120.978889, 14.70349 ], [ 120.97876, 14.703481 ], [ 120.978622, 14.70347 ], [ 120.978523, 14.703581 ], [ 120.9785, 14.703701 ], [ 120.978508, 14.70384 ], [ 120.978371, 14.70392 ], [ 120.978241, 14.70392 ], [ 120.978081, 14.703842 ], [ 120.977951, 14.70378 ], [ 120.977806, 14.70376 ], [ 120.977646, 14.703771 ], [ 120.977493, 14.703831 ], [ 120.977379, 14.703903 ], [ 120.977287, 14.70396 ], [ 120.977356, 14.704041 ], [ 120.977478, 14.704101 ], [ 120.977592, 14.70415 ], [ 120.977753, 14.70417 ], [ 120.977913, 14.704281 ], [ 120.977798, 14.704411 ], [ 120.977737, 14.704531 ], [ 120.977676, 14.70468 ], [ 120.977707, 14.70483 ], [ 120.977806, 14.704962 ], [ 120.977707, 14.705001 ], [ 120.977539, 14.705021 ], [ 120.977333, 14.70507 ], [ 120.977226, 14.70507 ], [ 120.977112, 14.705091 ], [ 120.976868, 14.705121 ], [ 120.976768, 14.705141 ], [ 120.976677, 14.705251 ], [ 120.976669, 14.70542 ], [ 120.976669, 14.705521 ], [ 120.976776, 14.705561 ], [ 120.976883, 14.70559 ], [ 120.976997, 14.705681 ], [ 120.977066, 14.705761 ], [ 120.977013, 14.705911 ], [ 120.976883, 14.706111 ], [ 120.976959, 14.706221 ], [ 120.977089, 14.706301 ], [ 120.977203, 14.706382 ], [ 120.977303, 14.70645 ], [ 120.977386, 14.7066 ], [ 120.977348, 14.70676 ], [ 120.977272, 14.706871 ], [ 120.977287, 14.706981 ], [ 120.977226, 14.70715 ], [ 120.977119, 14.707241 ], [ 120.977028, 14.70734 ], [ 120.976929, 14.70746 ], [ 120.976883, 14.707551 ], [ 120.976906, 14.707661 ], [ 120.97702, 14.707741 ], [ 120.977287, 14.70785 ], [ 120.977432, 14.70798 ], [ 120.977303, 14.70808 ], [ 120.977173, 14.708132 ], [ 120.977066, 14.708251 ], [ 120.976921, 14.708301 ], [ 120.976753, 14.708301 ], [ 120.976593, 14.708321 ], [ 120.976448, 14.708421 ], [ 120.97654, 14.70855 ], [ 120.976517, 14.708651 ], [ 120.976387, 14.70874 ], [ 120.976479, 14.70882 ], [ 120.976593, 14.708851 ], [ 120.976677, 14.708931 ], [ 120.976677, 14.70907 ], [ 120.976761, 14.70917 ], [ 120.976692, 14.709261 ], [ 120.97657, 14.709341 ], [ 120.976181, 14.7096 ], [ 120.977272, 14.709641 ], [ 120.97847, 14.70962 ], [ 120.979362, 14.709611 ], [ 120.980347, 14.70962 ], [ 120.981377, 14.709651 ], [ 120.981339, 14.70986 ], [ 120.981239, 14.709921 ], [ 120.981117, 14.709921 ], [ 120.98101, 14.709941 ], [ 120.980896, 14.709991 ], [ 120.980789, 14.710041 ], [ 120.980659, 14.710131 ], [ 120.980446, 14.7102 ], [ 120.980263, 14.71028 ], [ 120.980057, 14.710361 ], [ 120.979942, 14.71043 ], [ 120.979828, 14.71047 ], [ 120.979683, 14.710522 ], [ 120.979462, 14.71059 ], [ 120.979317, 14.71059 ], [ 120.979156, 14.71063 ], [ 120.979019, 14.710661 ], [ 120.97876, 14.71065 ], [ 120.978592, 14.710681 ], [ 120.978416, 14.710701 ], [ 120.978287, 14.710711 ], [ 120.978081, 14.710741 ], [ 120.977943, 14.710771 ], [ 120.977692, 14.71082 ], [ 120.977531, 14.71088 ], [ 120.977417, 14.710951 ], [ 120.977318, 14.711011 ], [ 120.977158, 14.711071 ], [ 120.977081, 14.71121 ], [ 120.977066, 14.71131 ], [ 120.976929, 14.71133 ], [ 120.976822, 14.711341 ], [ 120.976517, 14.71137 ], [ 120.976227, 14.711321 ], [ 120.975983, 14.711262 ], [ 120.975853, 14.711221 ], [ 120.975746, 14.711181 ], [ 120.975616, 14.711121 ], [ 120.975487, 14.711081 ], [ 120.975357, 14.711051 ], [ 120.975189, 14.711 ], [ 120.974846, 14.71092 ], [ 120.974693, 14.710871 ], [ 120.974548, 14.710831 ], [ 120.974281, 14.710751 ], [ 120.973839, 14.71061 ], [ 120.973663, 14.710561 ], [ 120.973763, 14.71082 ], [ 120.973801, 14.710944 ], [ 120.973846, 14.711081 ], [ 120.9739, 14.711142 ], [ 120.973953, 14.71121 ], [ 120.974052, 14.711282 ], [ 120.97422, 14.71125 ], [ 120.974266, 14.711219 ], [ 120.974457, 14.711101 ], [ 120.974701, 14.711047 ], [ 120.974777, 14.711031 ], [ 120.974876, 14.711061 ], [ 120.975037, 14.71115 ], [ 120.975121, 14.711344 ], [ 120.975151, 14.71142 ], [ 120.975166, 14.711506 ], [ 120.975197, 14.711691 ], [ 120.975143, 14.711984 ], [ 120.975121, 14.71209 ], [ 120.975136, 14.712233 ], [ 120.975159, 14.71244 ], [ 120.975296, 14.712581 ], [ 120.975365, 14.712608 ], [ 120.975403, 14.712621 ], [ 120.975471, 14.712625 ], [ 120.975563, 14.71263 ], [ 120.975761, 14.712621 ], [ 120.975845, 14.71261 ], [ 120.976028, 14.712581 ], [ 120.976318, 14.712481 ], [ 120.976593, 14.71238 ], [ 120.97686, 14.71222 ], [ 120.977074, 14.71204 ], [ 120.977226, 14.712011 ], [ 120.97747, 14.71207 ], [ 120.977631, 14.712151 ], [ 120.977783, 14.712161 ], [ 120.977898, 14.712141 ], [ 120.978012, 14.712094 ], [ 120.978088, 14.712061 ], [ 120.978363, 14.71198 ], [ 120.978477, 14.71197 ], [ 120.9786, 14.712071 ], [ 120.978561, 14.71218 ], [ 120.978653, 14.712177 ], [ 120.978828, 14.712171 ], [ 120.978966, 14.712177 ], [ 120.97905, 14.71218 ], [ 120.979156, 14.71218 ], [ 120.979286, 14.712155 ], [ 120.979622, 14.712061 ], [ 120.980598, 14.711921 ], [ 120.980957, 14.71203 ], [ 120.980896, 14.712151 ], [ 120.980759, 14.712231 ], [ 120.980736, 14.712259 ], [ 120.980652, 14.71236 ], [ 120.980553, 14.712581 ], [ 120.980629, 14.712831 ], [ 120.980766, 14.7129 ], [ 120.981087, 14.71306 ], [ 120.981239, 14.71306 ], [ 120.981339, 14.713001 ], [ 120.981438, 14.71268 ], [ 120.981796, 14.71225 ], [ 120.98201, 14.7122 ], [ 120.982193, 14.712231 ], [ 120.982323, 14.712264 ], [ 120.982536, 14.71232 ], [ 120.982697, 14.712291 ], [ 120.982834, 14.712183 ], [ 120.982971, 14.712081 ], [ 120.983238, 14.712001 ], [ 120.983566, 14.71203 ], [ 120.983986, 14.712521 ], [ 120.984367, 14.712678 ], [ 120.984573, 14.712761 ], [ 120.985817, 14.71277 ], [ 120.986771, 14.71273 ], [ 120.988159, 14.712251 ], [ 120.988617, 14.712197 ], [ 120.988846, 14.712171 ], [ 120.98893, 14.712159 ], [ 120.989067, 14.712141 ], [ 120.989647, 14.712298 ], [ 120.989769, 14.712331 ], [ 120.990257, 14.71265 ], [ 120.990829, 14.713282 ], [ 120.991051, 14.713531 ], [ 120.991112, 14.713598 ], [ 120.991287, 14.713811 ], [ 120.991417, 14.713871 ], [ 120.99202, 14.71415 ], [ 120.992958, 14.714911 ], [ 120.993019, 14.7151 ], [ 120.99334, 14.714581 ], [ 120.993599, 14.713511 ], [ 120.993797, 14.712861 ] ] ] }')



      return utilities;
}]);
    